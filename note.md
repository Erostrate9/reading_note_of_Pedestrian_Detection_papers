# A Shape Transformation-based Dataset Augmentation Framework for Pedestrian Detection

## Abstract

## Introduction

### 行人识别所遇到的问题

* deep convolutional neural networks (DCNNs) 深度卷积神经网络在行人识别中表现良好，但DCNNs识别器在遇到负背景比正前景突出的情况时可能会不够鲁棒。用有限前景样本训练的DCNN识别器面对未学习过的复杂测试物体会非常脆弱。
  * positive foreground or positive space 是图像中我们期望观察的主体，如行人。
  * negative background or negative space 是图像中主体以外的背景，如街道。

### 现有的解决方案

* 为了改善识别器的鲁棒性，数据增强是除设计新机器学习算法外的另一个解决方案。例如：
  * 像Stephan R. Richter等人用3D游戏GTA5识别生成图像数据集那样，Huang等人用一个3D游戏引擎生成行人，调整后加入训练集中。

  * 还有些研究使用了GANs，通过改变行人的姿势来扩充人重识别数据集。

### 存在的问题

* 但是上述的这些方法想要直接应用到行人识别是很困难的，因为：

1. 使用3D游戏引擎等外部平台合成行人可能会引入与真实行人间显著的域差距domain gap，总体上对鲁棒性的收益可能不大。
2. 关于利用GANs渲染行人的方法，这往往需要训练图像丰富的外观细节，以便于确定生成网络的期望输出，但真实的行人数据集（Caltech, CityPersons）往往图像质量低 （比如重度重叠，外观模糊，低分辨率），这些数据集只能提供非常少的能用于训练生成网络的外观细节，作者通过实验证明，在这些数据集中，现有的基于GAN的方法只能生成很少的真实行人，甚至产生了反作用。

### 对问题的观察

* 为了解决上述问题，作者建议通过根据不同形状（研究中的提到的segmentation mask）将来自同一数据集的真实行人转换成不同姿势，而不是渲染新的行人。这基于以下观察：
  1. 如果数据集只有低质量的行人示例可用，那么更容易获得丰富的像素级形状变换监督，该监督定义了从一个形态shape到另一个形态的变换。学习得到的变换可以指导真实行人外观的变换，同时避免了对定义变形后外观所需的细节监督信息的依赖。
  2. 由于形态shape信息可以自然地区分前景和背景，可以简单地将注意力集中在将合成的前景外观适配到背景环境中，即只生成前景，将原始背景与前景合成。这样就避免了目前一些GAN方法中在合成行人的同时制造不自然的背景环境的情况。
  3. 基于不同形状shape变换真实行人可以有效地增加前景的样本多样性，同时保持还能充分保持真实行人的外观特征。

### 解决方案

* 作者提出了一个基于形状变换的数据集增强框架——Shape Transformation based Dataset Augmentation (STDA)
* 图示：![](https://raw.githubusercontent.com/Erostrate9/img/main/20211213172947.png)
* 该框架首先将真实行人变形为相似但具有不同形状的行人，然后使变形的行人适应要增强的图像的背景。
  * 为了进一步定义形状和真实行人外观间一个合适的形状变换，作者引入了形状引导的变换场 shape-guided warping field，即一组定义了形状变换操作的向量。
  * 此外，作者还引入了环境感知混合映射来使变形后的行人更好的混合到多种背景场景中，这能产生看起来更真实的行人图像。

### 关键性贡献

1. 提出了一个STDA框架来扩充行人检测数据集，提高检测准确性。
2. 提出了形状引导变换场（shape-guided warping field）来定义适当的形状变换程序。引入了环境感知混合映射（environment-aware blending map）以让变形的行人适应到不同的背景中。
3. 引入形状约束操作来提高形状变换质量。应用了加大难分正样本挖掘损失函数（hard positive mining loss）以利用难分样本挖掘hard mining技术，同时进一步放大合成行人在提高检测鲁棒性上的优势。
   - 正样本：我们想要正确分类出的类别所对应的样本，例如，我们需要对一张图片分类，确定是否属于猫，那么在训练的时候，猫的图片就是正样本。
   - 负样本：根据上面的例子，不是猫的其他所有的图片都是负样本
   - 难分正样本(hard positives)：错分成负样本的正样本，也可以是训练过程中损失最高的正样本
   - 难分负样本(hard negatives)：错分成正样本的负样本，也可以是训练过程中损失最高的负样本
   - 易分正样本(easy positive)：容易正确分类的正样本，该类的概率最高。也可以是训练过程中损失最低的正样本
   - 易分负样本(easy negatives)：容易正确分类的负样本，该类的概率最高。也可以是训练过程中损失最低的负样本。
4. STDA框架不仅有利于分类识别，而且对于生成也是有希望的，框架可以生成更逼真的行人，提高检测器性能。

## 相关工作

### 行人识别

### 基于模拟的数据增强

### 基于GAN的数据增强

## Shape Transformation-based Dataset Augmentation Framework(STDA)

### 问题定义

